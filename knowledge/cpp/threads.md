# 线程相关
## 线程安全

### 什么是线程安全？
- 如果你的代码所在的进程中有多个线程在同时运行，而这些线程可能会同时运行这段代码。如果每次运行结果和 单线程运行的结果是一样的，而且其他的 变量的值也和预期的是一样的，就是线程安全的。
- 若每个线程中对 全局变量、 静态变量只有读操作，而无写操作，一般来说，这个全局变量是线程安全的；若有多个线程同时执行写操作，一般都需要考虑 线程同步，否则的话就可能影响线程安全。
- 栈是线程独有的，所以是线程安全的，堆是进程公共的，需要加锁才能达到线程安全


### 智能指针是线程安全的吗？
>（shared_ptr）的引用计数本身是安全且无锁的，但对象的读写则不是，因为 shared_ptr 有**两个数据成员**（指向类型的指针和共享的引用计数类型），读写操作不能原子化。
1. 同一个shared_ptr对象可以被多线程同时读取。
2. 不同的shared_ptr对象可以被多线程同时修改。
3. **同一个shared_ptr对象**不能被多线程直接修改（线程不安全），但可以通过原子函数完成。

![thread not safe](/knowledge/cpp/thread%20safe1.png)
![thread not safe](/knowledge/cpp/thread%20safe2.png)

http://www.cppblog.com/Solstice/archive/2013/01/28/197597.html
