### 堆和栈
- **堆和栈的区别是什么？**
1. 管理方式不同
    - 栈，由编译器自动管理，无需程序员手工控制；堆：产生和释放由程序员控制。
2. 空间大小不同
    - 栈的空间有限；堆内存可以达到4G，。
3. 能否产生碎片不同
    - 栈不会产生碎片，因为栈是种先进后出的队列。堆则容易产生碎片，多次的new/delete会造成内存的不连续，从而造成大量的碎片。
4. 生长方向不同
    - 堆的生长方式是向上的，栈是向下的。
5. 分配方式不同
    - 堆是动态分配的。栈可以是静态分配和动态分配两种，但是栈的动态分配由编译器释放。
6. 分配效率不同
    - 栈是机器系统提供的数据结构，计算机底层对栈提供支持：分配专门的寄存器存放栈的地址，压栈出栈都有专门的指令。堆则是由C/C++函数库提供，库函数会按照一定的算法在堆内存中搜索可用的足够大小的空间，如果没有足够大小的空间（可能是由于内存碎片太多），就有可能调用系统功能去增加程序数据段的内存空间，这样就有机会分到足够大小的内存，然后进行返回。显然，堆的效率比栈要低得多。
    - 堆和栈相比，由于大量new/delete的使用，容易造成大量的内存碎片；由于没有专门的系统支持，效率很低；由于可能引发用户态和核心态的切换，内存的申请，代价变得更加昂贵。所以栈在程序中是应用最广泛的，就算是函数的调用也利用栈去完成，函数调用过程中的参数，返回地址，EBP和局部变量都采用栈的方式存放。所以，我们推荐大家  尽量用栈，而不是用堆。
    - 栈和堆相比不是那么灵活，有时候分配大量的内存空间，还是用堆好一些。

- **线程是否有独立的空间**
    - linux下一个进程中的所有线程共享该进程的地址空间，但它们有各自独立的（私有的）栈(stack)。堆(heap)的分配与栈有所不同，一般是一个进程有一个C运行时堆，这个堆为本进程中所有线程共享。(一个进程下的所有线程有自己独立的栈，但是堆是共享进程的堆)

    - 堆：是大家共有的空间，分全局堆和局部堆。全局堆就是所有没有分配的空间，局部堆就是用户分配的空间。堆在操作系统对进程初始化的时候分配，运行过程中也可以向系统要额外的堆，但是记得用完了要还给操作系统，要不然就是内存泄漏。

    - 栈：是个**线程独有**的，保存其运行状态和局部自动变量的。栈在线程开始的时候初始化，每个线程的栈互相独立，因此，栈是**thread safe**的。操作系统在切换线程的时候会自动的切换栈，就是切换ＳＳ／ＥＳＰ寄存器。栈空间不需要在高级语言里面显式的分配和释放。

### 内存分布
- [内存分布](https://blog.csdn.net/cherrydreamsover/article/details/81627855)